var fs = require('fs');
var GoogleOAuth2 = require('google-oauth2-token');
var gToken;
var TOKEN_DIR = (process.env.HOME || process.env.HOMEPATH || process.env.USERPROFILE) +
    '/.credentials/';
var TOKEN_PATH = TOKEN_DIR + 'token.json';

function storeToken(token) {
    try {
        fs.mkdirSync(TOKEN_DIR);
    } catch (err) {
        if (err.code != 'EEXIST') {
            throw err;
        }
    }
    fs.writeFile(TOKEN_PATH, JSON.stringify(token));
    console.log('Token stored to ' + TOKEN_PATH);
}

exports.getToken = function() {
    console.log('getNEWTOKEN');
    var params = {
        email: 'giraftw2002@gmail.com',
        password: '0916@tpe',
        clientId: '596295171202-ehf1c4f3erbidcd7phdai7eb85t4r6ao.apps.googleusercontent.com', // Google API Client ID 
        clientSecret: 'hvy4ewl522NUECH2ntHFU46A', // Google API Client Secret 
        // lists of scope: developers.goorsgle.com/drive/v2/web/scopes#google_drive_scopes
        scope: 'https://www.googleapis.com/auth/drive'
    }
    GoogleOAuth2(params, function(err, tokens) {
        if (err) return console.error('err token')

        console.log('OAuth2 access token:', tokens.access_token);
        console.log('OAuth2 refresh token:', tokens.refresh_token);
        console.log('OAuth2 token expiry date:', new Date(tokens.expiry_date));
        //oauth2Client.credentials = token;
        //gToken = tokens.access_token;
        //storeToken(gToken);
    })
}

/*
module.exports = function() {
    // Check if we have previously stored a token.
    //fs.readFile(TOKEN_PATH, function(err, token) {
        //if (err) {
            //getNewToken();
        //} else {
        //    gToken = JSON.parse(token);
        //    console.log('token read from file', gToken);
        //}
    //});
    return {
        getToken: getNewToken,
        token: gToken
    };    
}
*/